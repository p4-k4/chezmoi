#!/bin/bash

# The script will run when flake.nix changes
# {{ include "flake.nix" | sha256sum }}

echo "ðŸ”„ Rebuilding Nix flake..."

# Change to chezmoi source directory
cd {{ .chezmoi.sourceDir }}

# Update flake lock file
nix flake update

echo "ðŸ“‹ removing chezmoi profile:"

nix profile remove chezmoi

# Clean up old generations
echo "ðŸ§¹ Cleaning up old generations..."
nix-collect-garbage -d

# Install new profile
echo "ðŸ“¦ Installing new profile..."
nix profile install .#default --accept-flake-config

echo "âœ… Flake rebuild complete!"
